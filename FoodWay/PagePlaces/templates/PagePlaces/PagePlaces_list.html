{% extends "Home/base_layer.html" %}

{% block content %}

{% load static %}
<style>
    a {
        text-decoration: none;
    }

    .list {
    }

    .list-item {
    }

        .list-item:hover {
            background-color: #c9c9c959;
        }

    .but_item {
        background-color: white;
        transition-duration: .5s;
    }

        .but_item:hover {
            cursor: pointer;
        }
</style>
<div class="container mt-4">
    <ul class="list">
        {% for item in PagePlaces %}
        <li class="shadow rounded-3 m-3 p-2 list-item">
            <div class="row">
                <div class="col-9">
                    <a href="{{item.get_absolute_url}}">
                        <h2 class="text-decoration-none">{{item.name}}</h2>
                    </a>
                    <p>Рейтинг: {{item.rating}}/5.00</p>
                    {% if item.phone %}<p class="mt-3 mb-1">Телефон: {{item.phone}}</p>{% endif %}
                    <p>{{item.short_info}}</p>
                </div>

                <div class="col-3 d-flex flex-column justify-content-center">
                    <a href="{{item.get_absolute_url}}#map" style="color:black">
                        <div class="text-center but_item shadow-sm m-1 rounded-3">
                            Посмотреть на карте
                        </div>
                    </a>
                    <a href="{% url 'editPagePlace' item.url %}" style="color:black">
                        <div class="text-center but_item shadow-sm m-1 rounded-3">
                            Редактирвать
                        </div>
                    </a>
                    <div class="text-center but_item shadow-sm m-1 rounded-3" onclick="delete_pageplace('{{item.id}}')">
                        Удалить
                    </div>
                </div>
            </div>
        </li>
        {% endfor %}
    </ul>

</div>


{% endblock content %}
{% block scripts %}
{{block.super}}
<script>
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    function delete_pageplace(id) {
        if (confirm('Страница удаляется без возможности восстановления. Продолжить?')) {
            $.ajax({
                url: "{% url 'deletePagePlace' %}",
                method: 'post',
                dataType: 'json',
                data: { 'id_PagePlaces': id },
                beforeSend: function (xhr) {
                    xhr.setRequestHeader("X-CSRFToken", getCookie('csrftoken'));
                },
                success: function (data) {

                    console.log(data);
                }
            });
        }
    }
</script>
{% endblock scripts %}